{% extends 'base.html' %}

{% block title %}Purchase Requests{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Purchase Requests</h2>
    {% if requests %}
    <div class="list-group mt-3">
        {% for r in requests %}
        <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">{{ r.item_title }}</h5>
                <small>{{ r.created_at }}</small>
            </div>
            <p class="mb-1">From: {{ r.requester_name }} &lt;{{ r.requester_email }}&gt;</p>
            <p class="mb-1">Message: {{ r.message or 'â€”' }}</p>
            <div class="mt-2">
                {# Show Accept/Decline when request is pending or paid (seller should confirm after payment) #}
                {% if r.status in ['pending', 'paid'] %}
                <form method="POST" action="{{ url_for('requests_bp.accept_request', request_id=r.id) }}" style="display:inline-block;">
                    <button class="btn btn-success btn-sm">Accept</button>
                </form>
                <form method="POST" action="{{ url_for('requests_bp.decline_request', request_id=r.id) }}" style="display:inline-block; margin-left:8px;">
                    <button class="btn btn-danger btn-sm">Decline</button>
                </form>
                {% else %}
                <span class="badge bg-secondary">{{ r.status }}</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info mt-3">No purchase requests at the moment.</div>
    {% endif %}
</div>
{% endblock %}
